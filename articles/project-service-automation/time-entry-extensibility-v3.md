---
title: 自定义周时间条目
description: 此主题介绍如何实施为组织的业务提供支持的自定义业务规则。
author: stsporen
manager: kfend
ms.service: dynamics-365-customerservice
ms.custom:
- dyn365-projectservice
ms.date: 07/09/2019
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.assetid: be87d2e8-fbfc-4270-adf9-6ce1e3e3bdd9
ms.author: rumant
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365CE
- D365PS
ms.openlocfilehash: e659a6b6b6e8685075b8eaf740585c16af670c57
ms.sourcegitcommit: 8c786230ef2a497280885b827162561776e2eb00
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/24/2020
ms.locfileid: "3749745"
---
# <a name="customize-weekly-time-entry"></a><span data-ttu-id="c2cb9-103">自定义周时间条目</span><span class="sxs-lookup"><span data-stu-id="c2cb9-103">Customize weekly time entry</span></span> 

[!INCLUDE[cc-applies-to-psa-app-3.x](../includes/cc-applies-to-psa-app-3x.md)]

<span data-ttu-id="c2cb9-104">在 Microsoft Dynamics 365 Project Service Automation 版本 3.3 中，Microsoft 引入了一个现代网格，供项目资源一次性快速输入最多一周的时间。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-104">In Microsoft Dynamics 365 Project Service Automation version 3.3, Microsoft introduced a modern grid that lets project resources quickly enter time for up to one week at a time.</span></span> <span data-ttu-id="c2cb9-105">这个新的周时间条目网格可以按日期、行或周显示条目的总计。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-105">The new weekly time entry grid can show totals for entries by date, by row, or by week.</span></span> <span data-ttu-id="c2cb9-106">资源可以创建周内时间条目的副本，还可以从之前周批量复制。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-106">Resources can make copies of time entries within the week and also bulk-copy from previous weeks.</span></span> <span data-ttu-id="c2cb9-107">系统定制员可以自定义视图，方法是添加字段，添加对其他实体的查找，以及实施自定义业务规则以支持其组织的业务。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-107">System customizers can customize the view by adding fields, adding lookups to other entities, and implementing custom business rules to support their organization's practices.</span></span>

<span data-ttu-id="c2cb9-108">时间条目和新的周时间网格通过站点地图访问。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-108">Time entry and the new weekly time grid are accessed through the site map.</span></span> <span data-ttu-id="c2cb9-109">早期 PSA 版本的不可扩展自定义时间条目体验已被可扩展周时间条目网格取代和只读网格和日历中的替代体验取代。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-109">The non-extensible custom time entry experience that was part of earlier PSA versions has been replaced by the extensible weekly time entry grid, and also by an alternative experience in the read-only grid and calendar.</span></span> <span data-ttu-id="c2cb9-110">由于此项更改，用户可以以周为量输入时间。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-110">Because of this change, users can enter time in weekly amounts.</span></span>

## <a name="page-layout"></a><span data-ttu-id="c2cb9-111">页面布局</span><span class="sxs-lookup"><span data-stu-id="c2cb9-111">Page layout</span></span>
<span data-ttu-id="c2cb9-112">新的周时间条目网格是一个自定义控件，其拥有一个工具栏和两个主部分，即**维度**和**持续时间**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-112">The new weekly time entry grid is a custom control that has a toolbar and two main sections, **Dimensions** and **Duration**.</span></span> <span data-ttu-id="c2cb9-113">工具栏中有一个仅适用于时间条目网格的此自定义控件的按钮。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-113">The toolbar includes a button that applies only to this custom control for the time entry grid.</span></span> <span data-ttu-id="c2cb9-114">相对而言，页面顶部操作窗格中的按钮适用于三种支持时间条目的控件：周时间条目控件、只读控件和日历控件。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-114">By contrast, the buttons on the Action Pane at the top of the page apply to the three types of controls that are supported for time entry: the weekly time entry control, the read-only control, and the calendar control.</span></span>

### <a name="dimensions"></a><span data-ttu-id="c2cb9-115">维度</span><span class="sxs-lookup"><span data-stu-id="c2cb9-115">Dimensions</span></span>
<span data-ttu-id="c2cb9-116">**维度**显示为列标题，其中显示可再次输入的所有时间维度。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-116">The **Dimensions** section shows, as column headings, all the dimensions that time can be entered against.</span></span> <span data-ttu-id="c2cb9-117">下图为支持的自带维度：</span><span class="sxs-lookup"><span data-stu-id="c2cb9-117">The following dimensions are supported out of the box:</span></span>

- <span data-ttu-id="c2cb9-118">项目</span><span class="sxs-lookup"><span data-stu-id="c2cb9-118">Project</span></span>
- <span data-ttu-id="c2cb9-119">项目任务</span><span class="sxs-lookup"><span data-stu-id="c2cb9-119">Project Task</span></span>
- <span data-ttu-id="c2cb9-120">角色</span><span class="sxs-lookup"><span data-stu-id="c2cb9-120">Role</span></span>
- <span data-ttu-id="c2cb9-121">类型 </span><span class="sxs-lookup"><span data-stu-id="c2cb9-121">Type</span></span>
- <span data-ttu-id="c2cb9-122">条目状态</span><span class="sxs-lookup"><span data-stu-id="c2cb9-122">Entry Status</span></span>

<span data-ttu-id="c2cb9-123">**维度**部分不允许内联编辑。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-123">The **Dimensions** section doesn't allow for inline editing.</span></span> <span data-ttu-id="c2cb9-124">此部分受一个视图支持，该视图支持向周时间条目网格添加自定义字段。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-124">This section is backed by a view that enables custom fields to be added to the weekly time entry grid.</span></span> <span data-ttu-id="c2cb9-125">有关如何添加自定义字段的信息，请参阅此主题后文的“扩展性”部分。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-125">For information about how to add custom fields, see the "Extensibility" section later in this topic.</span></span>

### <a name="duration"></a><span data-ttu-id="c2cb9-126">持续时间</span><span class="sxs-lookup"><span data-stu-id="c2cb9-126">Duration</span></span>
<span data-ttu-id="c2cb9-127">“持续时间”部分将星期几显示为列标题。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-127">The Duration section shows the days of the week as column headers.</span></span> <span data-ttu-id="c2cb9-128">此部分允许内联编辑。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-128">This section allows for inline editing.</span></span> <span data-ttu-id="c2cb9-129">创建了具有相应维度的时间条目行之后，用户可快速内联输入用在这些维度上的时间量。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-129">After a time entry row is created that has appropriate dimensions, users can quickly enter, inline, the amount of time that they spent on those dimensions.</span></span>

## <a name="create-a-new-time-entry"></a><span data-ttu-id="c2cb9-130">创建新时间条目</span><span class="sxs-lookup"><span data-stu-id="c2cb9-130">Create a new time entry</span></span>
<span data-ttu-id="c2cb9-131">若要在时间条目网格中输入新时间条目，请选择**新建**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-131">To create a new time entry in the time entry grid, select **New**.</span></span> <span data-ttu-id="c2cb9-132">将显示**时间条目快速创建**对话框。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-132">The **Time Entry Quick Create** dialog box appears.</span></span> <span data-ttu-id="c2cb9-133">在此对话框中，用户可选择时间条目日期，然后输入**项目**、**项目任务**、**角色**和**持续时间**维度的数据，以分钟、小时或天为单位，方法是键入 **h**、**m** 或 **d** 和数字。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-133">In this dialog box, users can select the time entry date, and then enter data for the **Project**, **Project Task**, **Role**, and **Duration** dimensions in minutes, hours, or days by typing **h**, **m**, or **d**, together with the number.</span></span> <span data-ttu-id="c2cb9-134">用户也可以为时间条目输入可在外部共享的描述和注释。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-134">Users can also enter a description and comments that can be shared externally for the time entry.</span></span> <span data-ttu-id="c2cb9-135">用户保存自己的更改时，将在**维度**部分中显示为维度输入的值。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-135">When users save their changes, the values that they entered against the dimensions appear in the **Dimensions** section.</span></span> <span data-ttu-id="c2cb9-136">其在**持续时间**字段中输入的持续时间信息在为其创建时间条目的日期上显示。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-136">Duration information that they entered in the **Duration** field appears on the date that the time entry was created for.</span></span>

<span data-ttu-id="c2cb9-137">查找字段受系统视图支持。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-137">Lookup fields are backed by system views.</span></span> <span data-ttu-id="c2cb9-138">例如，用户进入项目后，**项目任务**字段默认设置为**复制**视图。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-138">For example, after a user enters a project, the **Project Task** field is set to the **Copy** view by default.</span></span> <span data-ttu-id="c2cb9-139">若要为尚未分派给用户的任务创建时间条目，请在查找对话框中选择**更改视图**，然后选择**所有可用的项目任务**视图。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-139">To create time entries for tasks that aren't assigned to a user, select **Change View** in the lookup dialog box, and then select the **All Active Project Tasks** view.</span></span>

## <a name="edit-a-time-entry"></a><span data-ttu-id="c2cb9-140">编辑时间条目</span><span class="sxs-lookup"><span data-stu-id="c2cb9-140">Edit a time entry</span></span>
<span data-ttu-id="c2cb9-141">周时间条目网格中不显示时间条目页中某些字段（如**描述**和**外部注释**）内的详细信息。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-141">Details from some fields on the time entry page, such as **Description** and **External Comments**, aren't shown in the weekly time entry grid.</span></span> <span data-ttu-id="c2cb9-142">而是在具有这些额外详细信息的持续时间单元格中显示一个小三角指示器。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-142">Instead, a small triangular indicator appears in duration cells that have these additional details.</span></span> <span data-ttu-id="c2cb9-143">选择此类单元格，然后选择**编辑详细信息**可在**快速编辑**窗格中查看这些数据。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-143">Select the cell, and then select **Edit Details** to view the data in the **Quick Edit** pane.</span></span> <span data-ttu-id="c2cb9-144">若要编辑不属于周时间条目网格的某个特定时间条目的详细信息，用户必须打开**快速编辑**窗格。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-144">To edit or update the details for a specific time entry that isn't part of the weekly time entry grid, users must open the **Quick Edit** pane.</span></span>

## <a name="copy-a-time-entry-row"></a><span data-ttu-id="c2cb9-145">复制时间条目行</span><span class="sxs-lookup"><span data-stu-id="c2cb9-145">Copy a time entry row</span></span>
<span data-ttu-id="c2cb9-146">创建第一个时间条目行之后，用户可选择**复制行**将整行复制到新行。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-146">After the first time entry row has been created, users can select **Copy Row** to copy the whole row to a new row.</span></span> <span data-ttu-id="c2cb9-147">如果按照这种方法复制行，也将复制维度和持续时间。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-147">When a row is copied in this way, dimensions and durations are also copied.</span></span> <span data-ttu-id="c2cb9-148">用户还可以选择**编辑行**以在**持续时间**部分中内联更新维度值和持续时间。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-148">Users can also select **Edit Row** to update dimension values and durations inline in the **Duration** section.</span></span>

## <a name="open-a-time-entry"></a><span data-ttu-id="c2cb9-149">打开时间条目</span><span class="sxs-lookup"><span data-stu-id="c2cb9-149">Open a time entry</span></span>
<span data-ttu-id="c2cb9-150">为了支持最醒目字段中的最佳快速条目，周时间条目网格显示一小组选定维度和持续时间。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-150">To support optimal and quick entry in the most prominent fields, the weekly time entry grid show a subset of selected dimensions and time durations.</span></span> <span data-ttu-id="c2cb9-151">若要查看一个时间条目的所有详细信息，请在**编辑条目**下选择**打开**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-151">To view all the details of a single time entry, under **Edit Entry**, select **Open**.</span></span>

## <a name="submit-a-time-entry"></a><span data-ttu-id="c2cb9-152">提交时间条目</span><span class="sxs-lookup"><span data-stu-id="c2cb9-152">Submit a time entry</span></span>
<span data-ttu-id="c2cb9-153">用户可提交一个或一组时间条目，方法是选择单元格区域或整个时间条目行，然后选择**提交**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-153">Users can submit a single time entry or a group of time entries by selecting a block of cells or a whole time entry row, and then selecting **Submit**.</span></span> <span data-ttu-id="c2cb9-154">提交的时间条目在审批者的**审批**页中显示为待审批条目。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-154">Submitted time entries appear as entries that are pending approval on the approvers' **Approval** page.</span></span> <span data-ttu-id="c2cb9-155">时间条目在成功提交后不可编辑。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-155">After time entries are successfully submitted, they can't be edited.</span></span>

## <a name="recall-a-time-entry"></a><span data-ttu-id="c2cb9-156">撤消时间条目</span><span class="sxs-lookup"><span data-stu-id="c2cb9-156">Recall a time entry</span></span>
<span data-ttu-id="c2cb9-157">可撤销已提交的时间条目。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-157">You can recall time entries that you've submitted.</span></span> <span data-ttu-id="c2cb9-158">可撤销一个、一部分或整行时间条目。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-158">You can recall a single time entry, a block of time entries, or a whole row of time entries.</span></span> <span data-ttu-id="c2cb9-159">资源可编辑已撤销的时间条目。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-159">Recalled time entries are available to resources for editing.</span></span>

## <a name="time-entry-status"></a><span data-ttu-id="c2cb9-160">时间条目状态</span><span class="sxs-lookup"><span data-stu-id="c2cb9-160">Time entry status</span></span>
<span data-ttu-id="c2cb9-161">将为新时间条目自动分派**草稿**状态。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-161">New time entries are automatically assigned a status of **Draft**.</span></span> <span data-ttu-id="c2cb9-162">提交时间条目时，其状态更新为**已提交**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-162">When a time entry is submitted, the status is updated to **Submitted**.</span></span> <span data-ttu-id="c2cb9-163">批准已提交的时间条目时，其状态更新为**已批准**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-163">When a submitted time entry is approved, the status is updated to **Approved**.</span></span> <span data-ttu-id="c2cb9-164">如果拒绝了时间条目，其状态将更新为**已返回**，并且可更正和重新提交该条目。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-164">If a time entry is rejected, the status is updated to **Returned**, and the entry becomes available for correction and resubmission.</span></span> <span data-ttu-id="c2cb9-165">只能删除状态为**草稿**的时间条目。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-165">Only time entries that have a status of **Draft** can be deleted.</span></span>

## <a name="view-rejection-comments"></a><span data-ttu-id="c2cb9-166">查看拒绝注释</span><span class="sxs-lookup"><span data-stu-id="c2cb9-166">View rejection comments</span></span>
<span data-ttu-id="c2cb9-167">审批者在拒绝时间条目时，可能会添加拒绝注释来帮助资源了解拒绝原因。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-167">When a time entry is rejected by an approver, the approver might add rejection comments to help the resource understand the reason for the rejection.</span></span> <span data-ttu-id="c2cb9-168">若要查看时间条目的拒绝注释，请选择**打开条目**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-168">To view the rejection comments for a time entry, select **Open entry**.</span></span> <span data-ttu-id="c2cb9-169">将在时间线中显示拒绝注释。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-169">The rejection comments will be shown in the timeline.</span></span> <span data-ttu-id="c2cb9-170">用户在重新提交条目之前，可在时间线中响应拒绝注释。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-170">In the timeline, the resource can respond to the rejection comments before he or she resubmits the entry.</span></span>

## <a name="copy-week"></a><span data-ttu-id="c2cb9-171">复制周</span><span class="sxs-lookup"><span data-stu-id="c2cb9-171">Copy week</span></span>
<span data-ttu-id="c2cb9-172">创建一些时间条目之后，用户可以选择**复制周**批量创建更多时间条目。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-172">After a few time entries have been created, users can select **Copy Week** to bulk-create additional time entries.</span></span> <span data-ttu-id="c2cb9-173">将显示**复制**对话框。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-173">The **Copy** dialog box appears.</span></span> <span data-ttu-id="c2cb9-174">在**开始期间**部分中，使用**开始日期**和**结束日期**字段定义要复制的时间条目所属日期范围。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-174">In the **From period** section, use the **Start Date** and **End Date** fields to define the date range to copy time entries from.</span></span> <span data-ttu-id="c2cb9-175">在**目标期间**部分中**开始日期**字段内，指定要为其创建时间条目的日期。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-175">In the **To Period** section, in the **Start Date** field, specify the date to create time entries for.</span></span> <span data-ttu-id="c2cb9-176">然后选择**复制**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-176">Then select **Copy**.</span></span> <span data-ttu-id="c2cb9-177">对于“目标”期间内的指定日期，将为“开始”期间中相应星期几的时间条目创建一个副本。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-177">For the specified date in the "to" period, a copy of the time entries for the corresponding day of the week in the "from" period is created.</span></span> <span data-ttu-id="c2cb9-178">例如，将把上周星期一的时间条目复制到指定为“目标”期间的周的星期一。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-178">For example, Monday's time entry from last week is copied into Monday of the week that is specified as the "to" period.</span></span>

## <a name="import"></a><span data-ttu-id="c2cb9-179">导入</span><span class="sxs-lookup"><span data-stu-id="c2cb9-179">Import</span></span>
<span data-ttu-id="c2cb9-180">同样的基本流程用于从预订、分派和交换导入。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-180">The same basic process is used to import from bookings, assignments, and exchanges.</span></span> <span data-ttu-id="c2cb9-181">用户可指定导入的预订所属日期范围。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-181">Users can specify the date range that bookings are imported from.</span></span> <span data-ttu-id="c2cb9-182">然后必须明确选择应该复制到草稿时间条目中的预订。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-182">They must then explicitly select the bookings that should be copied into draft time entries.</span></span> <span data-ttu-id="c2cb9-183">在上一个版本中，建议的时间条目在网格和日历中显示，刷新会话后会消失。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-183">In the previous release, suggested time entries appeared in the grid and the calendar, and were lost when the session was refreshed.</span></span>

## <a name="extensibility"></a><span data-ttu-id="c2cb9-184">扩展性</span><span class="sxs-lookup"><span data-stu-id="c2cb9-184">Extensibility</span></span>
### <a name="add-custom-fields-that-have-lookups-to-other-entities"></a><span data-ttu-id="c2cb9-185">向其他实体添加具有查找的自定义字段</span><span class="sxs-lookup"><span data-stu-id="c2cb9-185">Add custom fields that have lookups to other entities</span></span>
<span data-ttu-id="c2cb9-186">向周时间条目网格添加自定义字段主要分三步。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-186">There are three main steps to adding a custom field to the weekly time entry grid.</span></span>

1.  <span data-ttu-id="c2cb9-187">将自定义字段添加到快速创建对话框。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-187">Add the custom field to the quick create dialog box.</span></span>
2.  <span data-ttu-id="c2cb9-188">配置网格以显示该自定义字段。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-188">Configure the grid to show the custom field.</span></span>
3.  <span data-ttu-id="c2cb9-189">根据需要将该自定义字段添加到行编辑任务流或单元格编辑任务流。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-189">Add the custom field to either the row edit task flow or the cell edit task flow, as appropriate.</span></span>

<span data-ttu-id="c2cb9-190">还必须确保新字段在行或单元格编辑任务流中进行必需的验证。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-190">You must also make sure that the new field has the required validations in the row or cell edit task flow.</span></span> <span data-ttu-id="c2cb9-191">此步骤中，必须基于时间条目状态锁定字段。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-191">As part of this step, you must lock the field, based on the time entry status.</span></span>

#### <a name="add-the-custom-field-to-the-quick-create-dialog-box"></a><span data-ttu-id="c2cb9-192">将自定义字段添加到快速创建对话框</span><span class="sxs-lookup"><span data-stu-id="c2cb9-192">Add the custom field to the quick create dialog box</span></span>
<span data-ttu-id="c2cb9-193">必须将自定义字段添加到“创建时间条目快速创建”对话框。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-193">You must add the custom field to the Create Time Entry Quick Create dialog box.</span></span> <span data-ttu-id="c2cb9-194">这样，用户就可以在使用**新建**按钮添加时间条目时为其输入值。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-194">so that users can enter a value for it when they add time entries by using the **New** button.</span></span>

#### <a name="configure-the-grid-to-show-the-custom-field"></a><span data-ttu-id="c2cb9-195">配置网格以显示该自定义字段</span><span class="sxs-lookup"><span data-stu-id="c2cb9-195">Configure the grid to show the custom field</span></span>
<span data-ttu-id="c2cb9-196">可通过两种方法向周时间条目网格添加自定义字段。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-196">There are two ways add a custom field to the weekly time entry grid.</span></span> <span data-ttu-id="c2cb9-197">第一种方法是自定义**我的周时间条目**视图并向其添加自定义字段。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-197">The first option is to customize the **My Weekly Time Entries** view and add the custom field to it.</span></span> <span data-ttu-id="c2cb9-198">可选择自定义字段在网格中的位置和大小，方法是在视图中编辑这些属性。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-198">You can choose the position and size of the custom field in the grid by editing those properties in the view.</span></span>

<span data-ttu-id="c2cb9-199">第二个选项是创建新的自定义时间条目视图，然后将其设置为默认视图。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-199">The second option is to create a new custom time entry view and set it as the default view.</span></span> <span data-ttu-id="c2cb9-200">除了网格中需要的列，此视图中还应包含**描述**和**外部注释**字段。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-200">This view should contain the **Description** and **External Comments** fields, in addition to the columns that you want to have in the grid.</span></span> <span data-ttu-id="c2cb9-201">可选择网格的位置、大小和默认排序顺序，方法是在视图中编辑这些属性。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-201">You can choose the position, size, and default sort order of the grid by editing those properties in the view.</span></span> <span data-ttu-id="c2cb9-202">接下来，配置此视图的自定义控件，使其成为**时间条目网格**控件。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-202">Next, configure the custom control for this view so that it's a **Time Entry Grid** control.</span></span> <span data-ttu-id="c2cb9-203">将此控件添加到视图，然后选择将其用于 Web、手机和平板电脑。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-203">Add this control to the view, and select it for web, phone, and tablet.</span></span> <span data-ttu-id="c2cb9-204">接下来，配置周时间条目网格的参数。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-204">Next, configure the parameters for the weekly time entry grid.</span></span> <span data-ttu-id="c2cb9-205">将**开始日期**字段设置为 **msdyn_date**，将**持续时间**字段设置为 **msdyn_duration**，将**状态**字段设置为 **msdyn_entrystatus**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-205">Set the **Start Date** field to **msdyn_date**, set the **Duration** field to **msdyn_duration**, and set the **Status** field to **msdyn_entrystatus**.</span></span> <span data-ttu-id="c2cb9-206">对于默认视图，**只读状态列表**字段设置为 **192350002,192350003,192350004**，**行编辑任务流**字段设置为 **msdyn_timeentryrowedit**，**单元格编辑任务流**字段设置为 **msdyn_timeentryedit**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-206">For the default view, the **Read-only Status List** field is set to **192350002,192350003,192350004**, the **Row Edit Task Flow** field is set to **msdyn_timeentryrowedit**, and the **Cell Edit Task Flow** field is set to **msdyn_timeentryedit**.</span></span> <span data-ttu-id="c2cb9-207">可自定义这些字段以添加或删除只读状态，或使用其他基于任务的体验 (TBX) 编辑行或单元格。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-207">You can customize these fields to add or remove read-only status, or to use a different task-based experience (TBX) for row or cell editing.</span></span> <span data-ttu-id="c2cb9-208">应将这些字段绑定到静态值。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-208">These fields should be bound to a static value.</span></span>

#### <a name="add-the-custom-field-to-the-appropriate-edit-task-flow"></a><span data-ttu-id="c2cb9-209">将自定义字段添加到相应编辑任务流</span><span class="sxs-lookup"><span data-stu-id="c2cb9-209">Add the custom field to the appropriate edit task flow</span></span>
<span data-ttu-id="c2cb9-210">用于编辑的 TBX 页位于**流程**下。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-210">The TBX pages that are used for editing can be found under **Processes**.</span></span> <span data-ttu-id="c2cb9-211">默认页为 **Project Service - 时间条目行编辑**和 **Project Service - 时间条目编辑**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-211">The default pages are **Project Service - Time Entry Row Edit** and **Project Service - Time Entry Edit**.</span></span> <span data-ttu-id="c2cb9-212">然后可编辑这些默认页或创建新的自定义 TBX 页。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-212">You can either edit these default pages or create new custom TBX pages.</span></span>

> [!NOTE] 
> <span data-ttu-id="c2cb9-213">两种选项都会移除对**项目**和**项目任务**实体的一些自带筛选，因此将显示这些实体的所有查找视图。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-213">Both options will remove some out-of-box filtering on **Project** and **Project Task** entities, so that all lookup views for the entities will be visible.</span></span> <span data-ttu-id="c2cb9-214">只有相关查找视图才会默认显示。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-214">Out of the box, only the relevant lookup views are visible.</span></span>

<span data-ttu-id="c2cb9-215">必须确定自定义字段的相应任务流。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-215">You must determine the appropriate task flow for the custom field.</span></span> <span data-ttu-id="c2cb9-216">最可能的是，如果将字段添加到了网格，则应进入对适用于整行时间条目的字段使用的行编辑任务流。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-216">Most likely, if you added the field to the grid, it should go in the row edit task flow that is used for fields that apply to the whole row of time entries.</span></span> <span data-ttu-id="c2cb9-217">如果自定义字段每天有唯一值（如**结束时间**的自定义字段），则应进入单元格编辑任务流。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-217">If the custom field has a unique value every day, such as a custom field for **End time**, it should go in the cell edit task flow.</span></span>

<span data-ttu-id="c2cb9-218">若要将自定义字段添加到任务流，请将一个**字段**元素拖到页中的相应位置，然后设置其属性。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-218">To add the custom field to a task flow, drag a **Field** element into the appropriate position on the page, and then set its properties.</span></span> <span data-ttu-id="c2cb9-219">将**来源**属性设置为**时间条目**，将**数据字段**属性设置为自定义字段。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-219">Set the **Source** property to **Time Entry**, and set the **Data Field** property to the custom field.</span></span> <span data-ttu-id="c2cb9-220">**字段**属性指定在 TBX 页上的显示名称。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-220">The **Field** property specifies the display name on the TBX page.</span></span> <span data-ttu-id="c2cb9-221">选择**应用**保存对字段进行的更改。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-221">Select **Apply** to save your changes to the field.</span></span> <span data-ttu-id="c2cb9-222">选择**更新**保存对页进行的更改。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-222">Then select **Update** to save your changes to the page.</span></span>

<span data-ttu-id="c2cb9-223">若要改用新的自定义 TBX 页，请创建一个新流程。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-223">To use a new custom TBX page instead, create a new process.</span></span> <span data-ttu-id="c2cb9-224">将类别设置为**业务流程**，将实体设置为**时间条目**，将业务流程类型设置为**将流程作为任务流运行**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-224">Set the category to **Business Process Flow**, set the entity to **Time Entry**, and set the business process type to **Run process as a task flow**.</span></span> <span data-ttu-id="c2cb9-225">应将**属性**下的**页面名称**属性设置为页面的显示名称。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-225">Under **Properties**, the **Page name** property should be set to the display name for the page.</span></span> <span data-ttu-id="c2cb9-226">将所有相关字段添加到 TBX 页。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-226">Add all the relevant fields to the TBX page.</span></span> <span data-ttu-id="c2cb9-227">保存并激活流程，然后将相关任务流的自定义控件属性更新为流程中的**名称**的值。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-227">Save and activate the process, and then update the custom control property for the relevant task flow to the value of **Name** on the process.</span></span>

### <a name="add-new-option-set-values"></a><span data-ttu-id="c2cb9-228">添加新选项集值</span><span class="sxs-lookup"><span data-stu-id="c2cb9-228">Add new option set values</span></span>
<span data-ttu-id="c2cb9-229">若要向自带字段添加选项集值，请打开该字段的编辑页，然后在**类型**下选择该选项集旁边的**编辑**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-229">To add option set values to an out-of-box field, open the editing page for the field, and then, under **Type**, select **Edit** next to the option set.</span></span> <span data-ttu-id="c2cb9-230">接下来，添加一个采用自定义标签和颜色的选项。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-230">Next, add a new option that has a custom label and color.</span></span> <span data-ttu-id="c2cb9-231">如果要添加新的时间条目状态，则自带字段将命名为**条目状态**，而不是**状态**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-231">If you want to add a new time entry status, the out-of-box field is named **Entry Status**, not **Status**.</span></span>

### <a name="designate-a-new-time-entry-status-as-read-only"></a><span data-ttu-id="c2cb9-232">将新时间条目状态指定为只读</span><span class="sxs-lookup"><span data-stu-id="c2cb9-232">Designate a new time entry status as read-only</span></span>
<span data-ttu-id="c2cb9-233">若要将新时间条目状态指定为只读，请将新时间条目值（编号，而不是标签）添加到**只读状态列表**属性中。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-233">To designate a new time entry status as read-only, add the new time entry value (the number, not the label) to the **Read-only Status List** property.</span></span> <span data-ttu-id="c2cb9-234">将对具有新状态的行锁定时间条目的可编辑部分。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-234">The editable part of the time entry grid will be locked for rows that have the new status.</span></span>
<span data-ttu-id="c2cb9-235">接下来，添加业务规则以锁定**时间条目行编辑**和**时间条目编辑** TBX 页中的所有字段。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-235">Next, add business rules to lock all the fields on the **Time Entry Row Edit** and **Time Entry Edit** TBX pages.</span></span> <span data-ttu-id="c2cb9-236">可以访问这些页的业务规则，方法是打开页的业务流程编辑器，然后选择**业务规则**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-236">You can access the business rules for these pages by opening the business process flow editor for the page and then selecting **Business Rules**.</span></span> <span data-ttu-id="c2cb9-237">可向现有规则中的条件添加新状态，也可以为新状态添加新业务规则。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-237">You can add the new status to the condition in the existing business rules, or you can add a new business rule for the new status.</span></span>

### <a name="add-custom-validation-rules"></a><span data-ttu-id="c2cb9-238">添加自定义验证规则</span><span class="sxs-lookup"><span data-stu-id="c2cb9-238">Add custom validation rules</span></span>
<span data-ttu-id="c2cb9-239">可以为周时间条目网格体验添加两种类型的验证规则：•   快速创建对话框和 TBX 页中支持的客户端业务规则 •   适用于所有时间条目更新的服务器端插件验证</span><span class="sxs-lookup"><span data-stu-id="c2cb9-239">There are two types of validation rules that you can add for the weekly time entry grid experience: •   Client-side business rules that work in quick create dialog boxes and on TBX pages •   Server-side plug-in validations that apply to all time entry updates</span></span>

#### <a name="business-rules"></a><span data-ttu-id="c2cb9-240">业务规则</span><span class="sxs-lookup"><span data-stu-id="c2cb9-240">Business rules</span></span>
<span data-ttu-id="c2cb9-241">可使用业务规则锁定和解锁字段，在字段中输入默认值，以及定义仅需要来自当前时间条目记录的信息的验证。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-241">Use business rules to lock and unlock fields, enter default values in fields, and define validations that require information only from the current time entry record.</span></span> <span data-ttu-id="c2cb9-242">可以访问 TBX 页的业务规则，方法是打开页的业务流程编辑器，然后选择**业务规则**。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-242">You can access the business rules for a TBX page by opening the business process flow editor for the page and then selecting **Business Rules**.</span></span> <span data-ttu-id="c2cb9-243">然后可以编辑现有业务规则或添加新的业务规则。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-243">You can then edit the existing business rules or add a new business rule.</span></span> <span data-ttu-id="c2cb9-244">对于自定义程度甚至更高的验证，可以使用业务规则运行 JavaScript。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-244">For even more customized validations, you can use a business rule to run JavaScript.</span></span>

#### <a name="plug-in-validations"></a><span data-ttu-id="c2cb9-245">插件验证</span><span class="sxs-lookup"><span data-stu-id="c2cb9-245">Plug-in validations</span></span>
<span data-ttu-id="c2cb9-246">应该将插件验证用于需要的上下文比单个时间条目记录中的可用上下文多的任何验证，或用于要对网格中的内联更新运行的任何验证。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-246">You should use plug-in validations for any validations that require more context than is available in a single time entry record, or for any validations that you want to run on inline updates in the grid.</span></span> <span data-ttu-id="c2cb9-247">若要完成验证，请在**时间条目**实体中创建一个自定义插件。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-247">To complete the validation, create a custom plug-in on the **Time Entry** entity.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="c2cb9-248">现在，当更新未通过插件验证时，TBX 页中的一项已知问题阻止用户更正信息和重新选择“完成”。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-248">Currently, a known issue on the TBX pages prevents users from correcting information and reselecting Done when an update fails a plug-in validation.</span></span> <span data-ttu-id="c2cb9-249">解决方法是，设置业务规则验证以尽量避免这种情况发生。</span><span class="sxs-lookup"><span data-stu-id="c2cb9-249">As a workaround, set up business rule validations to prevent this situation as much as possible.</span></span>
