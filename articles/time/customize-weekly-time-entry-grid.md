---
title: 扩展时间条目
description: 此主题提供有关开发人员如何扩展时间条目控件的信息。
author: stsporen
ms.date: 10/08/2020
ms.topic: article
ms.reviewer: kfend
ms.author: stsporen
ms.openlocfilehash: c36a47b09e6012925a047f81318e89167d5c506facaae8d72b0bb6e8e267a7d5
ms.sourcegitcommit: 7f8d1e7a16af769adb43d1877c28fdce53975db8
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/06/2021
ms.locfileid: "6993320"
---
# <a name="extending-time-entries"></a>扩展时间条目

_**适用于：** 基于资源/非库存场景的 Project Operations，精简部署 - 估价开票交易_

Dynamics 365 Project Operations 包括可扩展的时间条目自定义控件。 此控件包括以下功能：

- 在一周内横向输入时间
- 按日、行或周汇总
- 复制行或周
- 使用 HH:mm 或 HH.hh 的时间条目（自动转换为 HH.hh）
- 从工作、预订或约会导入

可以在两个方面扩展时间条目：
- [添加自定义时间条目供您自己使用](#add)
- [自定义每周时间条目控件](#customize)

## <a name="add-custom-time-entries-for-your-own-use"></a><a name="add"></a>添加自定义时间条目供您自己使用

时间条目是在多个场景中使用的核心实体。 在 2020 年 4 月第 1 波中，引入了 TESA 核心解决方案。 TESA 提供 **设置** 实体和新的 **时间条目用户** 安全角色。 还提供了新字段 **msdyn_start** 和 **msdyn_end**，它们与 **msdyn_duration** 有直接关系。 新实体、安全角色和字段使跨多个产品的时间分配方法更加统一。


### <a name="time-source-entity"></a>时间源实体
| 字段 | 描述 | 
|-------|------------|
| 客户  | 创建时间条目时用作选择值的时间源条目的名称。 |
| 默认时间源 [时间源：isdefault] | 默认情况下，默认时间源只能标记一个时间源。 这允许条目默认为时间源（如果未指定）。 |
|时间源类型 [时间源：sourcetype] | 源类型是一个选项（时间条目源类型），允许时间源与应用关联。 Microsoft 会保留大于 190,000,000 的值。|


### <a name="time-entries-and-the-time-source-entity"></a>时间条目和时间源实体
每个时间条目都与一个时间源记录相关联。 此记录确定如何以及哪些应用程序应处理时间条目。

时间条目始终是一个连续的时段，连接了开始、结束和持续时间。

逻辑将在以下情况下自动更新时间条目记录：

- 如果提供了以下三个字段中的两个，将自动计算第三个： 

    - **msdyn_start**
    - **msdyn_end**
    - **msdyn_duration**

- **msdyn_start** 和 **msdyn_end** 字段可识别时区。
- 创建的仅指定 **msdyn_date** 和 **msdyn_duration** 的时间条目将在午夜开始。 **msdyn_start** 和 **msdyn_end** 字段将相应更新。

#### <a name="time-entry-types"></a>时间条目类型

时间条目记录具有关联的类型，其定义关联的应用程序的提交流中的行为。

|标签 | 值|
|-----|-----|
|在休息时   |192,355,000|
|旅行 | 192,355,001|
|加班   | 192,354,320|
|工作   | 192,350,000|
|休假    | 192,350,001|
|休假   | 192,350,002|



## <a name="customize-the-weekly-time-entry-control"></a><a name="customize"></a>自定义每周时间条目控件
开发人员可以向其他实体添加其他字段和查找，并实施自定义业务规则以支持其业务场景。

### <a name="add-custom-fields-with-lookups-to-other-entities"></a>向其他实体添加具有查找的自定义字段
向周时间条目网格添加自定义字段主要分三步。

1. 将自定义字段添加到快速创建对话框。
2. 配置网格以显示该自定义字段。
3. 将该自定义字段添加到行编辑任务流或单元格编辑任务流。

应确保新字段在行或单元格编辑任务流中进行必需的验证。 此步骤中，基于时间条目状态锁定字段。

### <a name="add-the-custom-field-to-the-quick-create-dialog-box"></a>将自定义字段添加到快速创建对话框
将自定义字段添加到 **创建时间条目快速创建** 对话框。 然后，当添加时间条目时，可以通过选择 **新建** 输入值。

### <a name="configure-the-grid-to-show-the-custom-field"></a>配置网格以显示该自定义字段
可通过两种方法向周时间条目网格添加自定义字段：

  - 自定义视图和添加自定义字段
  - 创建新的默认自定义时间条目 


#### <a name="customize-a-view-and-add-a-custom-field"></a>自定义视图和添加自定义字段

自定义 **我的周时间条目** 视图并向其添加自定义字段。 可选择自定义字段在网格中的位置和大小，方法是在视图中编辑这些属性。

#### <a name="create-a-new-default-custom-time-entry"></a>创建新的默认自定义时间条目

除了网格中需要的列，此视图中还应包含 **描述** 和 **外部注释** 字段。 

1. 选择网格的位置、大小和默认排序顺序，方法是在视图中编辑这些属性。 
2. 配置此视图的自定义控件，使其成为 **时间条目网格** 控件。 
3. 将此控件添加到视图，然后选择将其用于 Web、手机和平板电脑。 
4. 配置周时间条目网格的参数。 
5. 将 **开始日期** 字段设置为 **msdyn_date**，将 **持续时间** 字段设置为 **msdyn_duration**，将 **状态** 字段设置为 **msdyn_entrystatus**。 
6. 对于默认视图，**只读状态列表** 字段将设置为 **192350002,192350003,192350004**。 **行编辑任务流** 字段设置为 **msdyn_timeentryrowedit**。 **单元格编辑任务流** 字段设置为 **msdyn_timeentryedit**。 
7. 可自定义这些字段以添加或删除只读状态，或使用其他基于任务的体验 (TBX) 编辑行或单元格。 这些字段现在已绑定到静态值。


> [!NOTE] 
> 两种选项都会移除对 **项目** 和 **项目任务** 实体的一些自带筛选，因此将显示这些实体的所有查找视图。 只有相关查找视图才会默认显示。

确定自定义字段的相应任务流。 如果将字段添加到了网格，则应进入对适用于整行时间条目的字段使用的行编辑任务流。 如果自定义字段每天有唯一值（如 **结束时间** 的自定义字段），则应进入单元格编辑任务流。

若要将自定义字段添加到任务流，请将一个 **字段** 元素拖到页中的相应位置，然后设置字段属性。 将 **来源** 属性设置为 **时间条目**，将 **数据字段** 属性设置为自定义字段。 **字段** 属性指定在 TBX 页上的显示名称。 选择 **应用** 将更改保存到字段，然后选择 **更新** 将更改保存到页面。

若要改用新的自定义 TBX 页，请创建一个新流程。 将类别设置为 **业务流程**，将实体设置为 **时间条目**，将业务流程类型设置为 **将流程作为任务流运行**。 应将 **属性** 下的 **页面名称** 属性设置为页面的显示名称。 将所有相关字段添加到 TBX 页。 保存并激活流程。 将相关任务流的自定义控件属性更新为流程中的 **名称** 的值。

### <a name="add-new-option-set-values"></a>添加新选项集值
若要向自带字段添加选项集值，请打开该字段的编辑页，在 **类型** 下选择该选项集旁边的 **编辑**。 添加一个采用自定义标签和颜色的选项。 如果要添加新的时间条目状态，则自带字段将命名为 **条目状态**，而不是 **状态**。

### <a name="designate-a-new-time-entry-status-as-read-only"></a>将新时间条目状态指定为只读
若要将新时间条目状态指定为只读，请将新时间条目值添加到 **只读状态列表** 属性中。 将对具有新状态的行锁定时间条目的可编辑部分。
接下来，添加业务规则以锁定 **时间条目行编辑** 和 **时间条目编辑** TBX 页中的所有字段。 可以访问这些页的业务规则，方法是打开页的业务流程编辑器，然后选择 **业务规则**。 可向现有规则中的条件添加新状态，也可以为新状态添加新业务规则。

### <a name="add-custom-validation-rules"></a>添加自定义验证规则
您可以为每周时间条目网格体验添加两种类型的验证规则：

- 在快速创建对话框和 TBX 页面上起作用的客户端业务规则。
- 应用于所有时间条目更新的服务器端插件验证。

#### <a name="business-rules"></a>业务规则
可使用业务规则锁定和解锁字段，在字段中输入默认值，以及定义仅需要来自当前时间条目记录的信息的验证。 可以访问 TBX 页的业务规则，方法是打开页的业务流程编辑器，然后选择 **业务规则**。 然后可以编辑现有业务规则或添加新的业务规则。 对于自定义程度甚至更高的验证，可以使用业务规则运行 JavaScript。

#### <a name="plug-in-validations"></a>插件验证
将插件验证用于需要的上下文比单个时间条目记录中的可用上下文多的任何验证，或用于要对网格中的内联更新运行的任何验证。 若要完成验证，请在 **时间条目** 实体中创建一个自定义插件。

### <a name="copying-time-entries"></a>复制时间条目
使用视图 **复制时间条目列** 定义时间输入期间要复制的字段列表。 **日期** 和 **持续时间** 是必填字段，不应从视图中删除。


[!INCLUDE[footer-include](../includes/footer-banner.md)]