---
title: 创建手动估价发票
description: 本主题提供有关创建估价发票的信息。
author: rumant
manager: AnnBe
ms.date: 09/18/2020
ms.topic: article
ms.prod: ''
ms.service: project-operations
audience: Application User
ms.reviewer: kfend
ms.search.scope: ''
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.search.industry: Service industries
ms.author: suvaidya
ms.dyn365.ops.version: ''
ms.search.validFrom: 2020-10-01
ms.openlocfilehash: 9d3c84664f1b0701db17f0c05654e0c99bb6c640
ms.sourcegitcommit: 4cf1dc1561b92fca4175f0b3813133c5e63ce8e6
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/28/2020
ms.locfileid: "4128046"
---
# <a name="create-a-manual-proforma-invoice"></a>创建手动估价发票

_**适用于：** 面向资源/非库存场景的 Project Operations_

开票可以在项目经理为客户创建发票之前为项目经理增加一级审批。 批准了项目团队成员提交的时间和支出条目时，即完成了第一级审批。

Dynamics 365 Project Operations 不应生成面向客户的发票，原因如下：

- 其中不包含税务信息。
- 不能使用当前配置的汇率将其他货币转换为开票货币。
- 不能正确设置发票格式以打印发票。

但是，您可以使用财务或会计系统创建面向客户的发票以使用生成的发票方案的信息。

## <a name="creating-project-invoices"></a>创建项目发票

项目发票可以一次创建一个，也可以批量创建。 可以手动创建，也可以配置为通过自动运行来生成。

### <a name="manually-create-project-invoices"></a>手动创建项目发票 

从 **项目合同** 列表页，可以为每个项目合同分别创建项目发票，也可以为多个项目合同批量创建发票。

请执行以下步骤为特定项目合同创建发票。

- 在 **项目合同** 列表页中，打开一个项目合同，然后选择 **创建发票**。

    将为所选项目合同的所有状态为 **已准备好开具发票** 的交易生成发票。 这些交易包括时间、支出、里程碑和基于产品的合同子项。

执行以下步骤批量创建发票。

1. 在 **项目合同** 列表页，选择必须为其创建发票的一个或多个项目合同，然后选择 **创建项目合同**。

    将显示警告消息，说明可能会经过一段延迟才会创建发票。 还将显示进度。

2. 选择 **确定** 关闭消息框。

    将为合同子项中所有状态为 **已准备好开具发票** 的交易生成发票。 这些交易包括时间、支出、里程碑和基于产品的合同子项。

3. 若要查看生成的发票，请转到 **Sales** \> **记帐** \> **发票**。 您将看到每个项目合同的一张发票。

### <a name="set-up-automated-creation-of-project-invoices"></a>设置项目发票自动创建 

执行以下步骤以配置自动化发票运行。

1. 转至 **设置** \> **批处理作业**。
2. 创建一个批处理作业，将其命名为 **Project Operations 创建发票**。 此批处理作业的名称中必须包含术语“创建发票”。
3. 在 **作业类型** 字段中，选择 **无**。 默认情况下，**每天频率** 和 **可用** 选项设置为 **是**。
4. 选择 **运行工作流**。 在 **查找记录** 对话框中，您将看到三个工作流：

    - ProcessRunCaller
    - ProcessRunner
    - UpdateRoleUtilization

5. 选择 **ProcessRunCaller**，然后选择 **添加**。
6. 在下一个对话框中，选择 **确定**。 **Sleep** 工作流后是 **Process** 工作流。

    可以选择步骤 5 中的 **ProcessRunner**。 然后，当您选择 **确定** 时，**Process** 工作流后是 **Sleep** 工作流。

**ProcessRunCaller** 和 **ProcessRunner** 工作流创建发票。 **ProcessRunCaller** 调用 **ProcessRunner**。 **ProcessRunner** 是真正创建发票的工作流。 它浏览必须为其创建发票的所有合同子项，然后为这些子项创建发票。 为了确定必须为其创建发票的合同子项，作业将查看合同子项的发票运行日期。 如果属于一个合同的合同子项具有同一个发票运行日期，将把交易合并到一张具有两项发票明细的发票中。 如果没有需要为其创建发票的交易，作业将跳过发票创建。

**ProcessRunner** 完成运行之后，将调用 **ProcessRunCaller**，提供结束时间，然后关闭。 然后，**ProcessRunCaller** 启动一个从指定结束日期开始运行 24 小时的计时器。 此计时器结束时，将关闭 **ProcessRunCaller**。

用于创建发票的批处理作业是周期性作业。 如果多次运行此批处理流程，将创建多个作业实例，并导致出错。 因此，仅应启动此批处理流程一次，并且仅当其停止运行时才应重新启动它。

> [!NOTE]
> 仅为按发票计划配置的项目合同子项运行批处理开票。 必须为采用固定价格记帐方法的合同子项配置里程碑。 将需要为采用时间和材料记帐方法的项目合同子项设置基于日期的发票计划。 这同样适用于基于项目的合同子项。      
 
### <a name="edit-a-draft-invoice"></a>编辑草稿发票

创建项目草稿发票时，将把批准时间和支出条目时创建的所有未记帐销售交易提取到该发票中。 可以在发票仍然处于草稿阶段时进行以下调整：

- 删除或编辑发票明细详细信息。
- 编辑和调整数量和记帐类型。
- 直接将时间、支出和费用作为交易添加到发票中。 如果发票明细映射到允许这些交易分类的合同明细，则可使用此功能。

选择 **确认** 以确认发票。 “确认”操作是单向操作。 选择 **确认** 时，系统将把发票设置为只读，并根据每项发票明细的每项发票明细详细信息创建已记帐实际销售额。 如果发票明细详细信息引用未记帐实际销售额，系统还将冲销这个未记帐实际销售额。 （所有基于时间或支出条目创建的发票明细详细信息都将引用未记帐实际销售额。）总帐集成系统可以使用此项冲销来冲销项目的在制品 (WIP) 以达成会计目的。

### <a name="correct-a-confirmed-invoice"></a>更正已确认的发票

可以编辑（更正）已确认的发票。 更正已确认的发票时，将创建新的草稿纠正发票。 因为假设您希望冲销原始发票中的所有交易和数量，所以此纠正发票中包含原始发票中的所有交易，并且其中的所有数量均为 0（零）。

如果有任何交易不需要更正，可以将其从草稿纠正发票中删除。 如果要仅冲销或返回部分数量，可以编辑明细详细信息中的 **数量** 字段。 如果打开发票明细详细信息，可以看到原始发票数量。 然后可以编辑当前发票数量，使其比原始发票数量少或多。

确认纠正发票时，将撤消原始已记帐实际销售额，并创建新的已记帐实际销售额。 如果减少了数量，差额将导致也创建一项新的未记帐实际销售额。 例如，如果原始已记帐销售额是八小时的，并且纠正发票明细详细信息的减少后数量为六小时，将冲销原始已记帐销售明细，并创建两项新的实际值：

- 六小时的已记帐实际销售额。
- 其余两小时的未记帐实际销售额。 以后可为此交易记帐或标记为非应计费，具体取决于与客户的协商结果。
