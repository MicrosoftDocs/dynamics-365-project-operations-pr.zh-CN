---
title: 使用 Project Service Automation 数据模型
description: 此主题介绍如何使用该数据模型。
author: ruhercul
manager: kfend
ms.service: project-operations
ms.custom:
- dyn365-projectservice
ms.date: 03/01/2019
ms.topic: article
ms.author: ruhercul
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365CE
- D365PS
- ProjectOperations
ms.openlocfilehash: 25f1af15c03001a92f96689ff36a3159a5352a46
ms.sourcegitcommit: fa32b1893286f20271fa4ec4be8fc68bd135f53c
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/15/2021
ms.locfileid: "5283222"
---
# <a name="working-with-the-project-service-automation-data-model"></a>使用 Project Service Automation 数据模型

[!include [banner](../includes/psa-now-project-operations.md)]

[!INCLUDE[cc-applies-to-psa-app-3.x](../includes/cc-applies-to-psa-app-3x.md)]
[!include [rename-banner](~/includes/cc-data-platform-banner.md)]

Dynamics 365 Project Service Automation 在 Common Data Service 数据模型中扩展了其他应用程序实体，并引入了自己的实体。 此主题介绍您将在典型 PSA 报告方案中遇到的一些实体。

## <a name="reporting-on-opportunities"></a>商机的报告

Project Service Automation 通过添加用于实现基于项目的方案的字段，扩展了 Dynamics 365 Sales 的 **商机** 实体。 可通过带有前缀 **msdyn\_** 的架构名称识别这些字段。 对报告 PSA 商机至关重要的一个新字段为 **订单类型**。 此字段的 **基于工作** 值指示商机为 PSA 商机。 为此实体增加的其他字段包括 **合同签订组织**，用于捕获持有商机的组织，以及 **客户经理**，用于捕获负责商机的客户经理的姓名。

**商机明细** 实体中也有与 Project Service 有关的字段。 **记帐方法** 指示应该基于时间和材料为商机明细记帐，还是基于固定价格，而 **项目** 则用于捕获商机后面的项目的名称。 可报告的其他字段用于捕获明细项的成本和客户预算金额。

## <a name="reporting-on-quotes"></a>报价单的报告

PSA 通过增加与项目有关的字段扩展 Sales 的 **报价单** 实体。 **订单类型** 用于区分 PSA 报价单和非 PSA 报价单。 此字段的 **基于工作** 值指示报价单为 PSA 报价单。 可能与 PSA 报价单的报告有关的其他字段包括金额字段，如 **应计费成本**、**不应计费成本**、**毛利**、**估算** 和 **预算**。 其他有用字段指示报价单是否可盈利，是否可以按照计划完工，以及是否满足客户的预算期望。

PSA 还扩展了 Sales 的 **报价单明细** 实体。 PSA 增加的一个字段是 **记帐方法**，用于指示如何为报价单明细记帐（时间和材料，还是固定价格）。 已向该实体增加的其他字段用于捕获报价单明细、开票、成本和预算背后的相关项目。

PSA 还为 Dynamics 365 数据模型新增了基于报价单的实体。 以下是一些示例：

- **报价单明细详细信息** – 此实体中包含报价单明细的项目估算详细信息。 每项报价单明细有两条记录。 一条记录存储报价单明细的成本和成本详细信息，另一条记录存储报价单明细的销售额和销售详细信息。
- **报价单明细发票计划** – 此实体中包含报价单明细的记帐计划。 此计划是基于为报价单明细分派的开票频率生成的。
- **报价单明细里程碑** – 此实体中包含固定价格报价单明细的记帐里程碑。
- **报价单明细分析分解** – 此实体中包含报价单明细的财务详细信息。 这些详细信息可能对按各种维度报告已报价的销售和估算成本金额非常有用。

PSA 为报价单增加的其他实体是 **报价单明细项目价目表**、**报价单明细资源类别** 和 **报价单明细交易类别**。

![显示报价单、报价单行和项目关系的关系图](media/PS-Reporting-image2.png "显示报价单、报价单行和项目关系的关系图")

## <a name="reporting-on-project-contracts"></a>项目合同的报告

PSA 扩展了记录项目合同时使用的 Sales **订单** 实体。 它新增了重要字段 **订单类型**，用于将合同标识为 PSA 项目合同，而不是销售合同。 此字段的 **基于工作** 值指示订单为 PSA 项目合同。 为 **订单** 实体增加的其他新字段用于捕获有关成本、PSA 合同状态和合同所属组织的详细信息。

PSA 还扩展了 Sales 的 **销售订单明细** 实体。 还增加了用于捕获记帐方法（时间和材料或固定价格）、客户预算金额和基础项目的字段。

PSA 还新增了针对项目合同的实体。 以下是一些示例：

- **项目合同明细详细信息** – 此实体中包含汇总为合同明细金额的明细级详细信息。 其详细程度可以达到在任务级基于项目计划生成的明细项。
- **合同明细发票计划** – 此实体中包含基于为合同明细分派的发票频率生成的记帐计划。
- **合同里程碑** – 此实体中包含具有固定价格记帐期限的合同明细的记帐里程碑。

PSA 为合同增加的其他实体是 **项目合同明细项目价目表**、**项目合同明细资源类别** 和 **项目合同明细交易类别**。

![显示订单、订单行和项目关系的关系图](media/PS-Reporting-image3.png "显示订单、订单行和项目关系的关系图")

## <a name="reporting-on-projects"></a>项目的报告

**项目** 实体及其相关实体是 PSA 独有的实体。 **项目** 是用于捕获运营的工作和成本信息的顶级实体。 下面是相关实体的列表：

- **项目团队成员** – 此实体中包含有关为项目分派的可预订资源的详细信息。 这些资源可以是通用可预订资源，也可以是由项目经理输入或基于项目计划生成的指定可预订资源。
- **项目任务** – 此实体中包含构成项目计划或计划的任务。
- **资源分派** – 此实体中包含可预订资源的任务分派。
- **资源要求** – 此实体中包含针对任何通用资源团队成员的要求。
- **估算** 和 **估算明细** – 这些资源之间存在标头/明细关系，其中包含项目的支出估算。 任务估算存储在 **资源估算** 视图中。

![显示资源要求和项目关系的关系图](media/PS-Reporting-image4.png "显示资源要求和项目关系的关系图")

## <a name="reporting-on-resources"></a>资源的报告

项目资源使用 Universal Resource Scheduling (URS) 中与其他应用（如 Microsoft Dynamics 365 Field Service）共享的 **可预订资源** 实体。 下面是报告项目资源时可能必须使用的实体的列表。

- **可预订资源** – 此实体表示项目团队使用的用户、联系人、通用资源、帐户、组或设备。
- **可预订资源特征** – 此实体包括资源的技能、认证或教育情况。 这些特征可能有由分级模型定义的等级值。
- **可预订资源类别** – 此实体表示可预订资源的角色。
- **可预订资源预订** – 此实体表示为项目预订的资源时间。 每项预订都有标头实体和明细实体，而每项明细都有用于表示预订状态的状态。

![显示可预订资源特征关系的关系图](media/PS-Reporting-image5.png "显示可预订资源特征关系的关系图")

## <a name="reporting-on-actual-transactions"></a>实际交易的报告

在 PSA 中审批时间表或支出，或为合同开票时，**实际** 实体中将捕获业务交易。 在 PSA 中，此实体可充当几乎所有与财务有关的报表的基础。 **实际值** 实体用于捕获业务事件的成本和销售交易。 还用于捕获大量相关属性。

使用 **实际值** 实体时，务必了解该实体中记录哪个或哪些交易，以及交易的记录时间。 下面是使用时间条目的典型流程（支出条目的流程类似）：

1. 保存时间条目时，在 **实际值** 实体中不创建任何记录。
2. 提交时间条目时，在 **实际值** 实体中不创建任何记录。
3. 批准时间条目时，在 **实际值** 实体中创建一条记录，还可以再创建一条记录。 第一条记录存储时间条目的成本。 第二条记录存储时间条目的未记帐销售额。 第二条记录取决于是否为项目分派了客户、报价单或合同明细。

    | 文档日期 | 交易类型 | 交易分类 | 客户         | 合同   | 资源     | 资源角色 | 记帐类型 | 数量 | 单价 | 金额 |
    |---------------|------------------|-------------------|------------------|------------|--------------|---------------|--------------|----------|------------|--------|
    | 2/3/18        | 成本             | Time              | Alpine ski 住宅 | Alpine CRM | 候婵 | 项目经理   | 应计费   | 8.0      | 50.00      | 400.00 |
    | 2/3/18        | 未记帐销售额   | Time              | Alpine ski 住宅 | Alpine CRM | 候婵 | 项目经理   | 应计费   | 8.0      | 100.00     | 800.00 |

    这两条记录是独立但相关的记录。 既不是借项，也不是贷项。

4. 如果某个合同与该项目关联，则为时间条目开票时，将在 **实际值** 实体中再创建两条记录。 首先创建未记帐销售记录的负额。 此记录本质上用于冲销未记帐销售。 再为已记帐销售创建一笔交易。 同样，这些记录是独立但有关的记录，并且既不是借项，也不是贷项。

    | 文档日期 | 交易类型 | 交易分类 | 客户         | 合同   | 资源     | 资源角色 | 记帐类型 | 数量 | 单价 | 金额   |
    |---------------|------------------|-------------------|------------------|------------|--------------|---------------|--------------|----------|------------|----------|
    | 2/4/18        | 未记帐销售额   | Time              | Alpine ski 住宅 | Alpine CRM | 候婵 | 项目经理   | 应计费   | - 8.0    | 100.00     | - 800.00 |
    | 2/4/18        | 已记帐销售额     | Time              | Alpine ski 住宅 | Alpine CRM | 候婵 | 项目经理   | 应计费   | 8.0      | 100.00     | 800.00   |

**交易起源** 实体记录 **实际值** 记录的来源，而 **交易连接** 实体则记录 **实际值** 记录的相关记录。 此外，**实际值** 记录中包含对项目、项目合同（订单）、可预订资源和客户的引用。

![显示事务连接、原始和实际关系的关系图](media/PS-Reporting-image6.png "显示事务连接、原始和实际关系的关系图")


[!INCLUDE[footer-include](../includes/footer-banner.md)]