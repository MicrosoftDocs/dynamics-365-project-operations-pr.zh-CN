---
title: 创建内部公司交易
description: 本文提供有关如何创建内部公司交易的信息。
author: sigitac
ms.date: 04/12/2021
ms.topic: article
ms.reviewer: johnmichalak
ms.author: sigitac
ms.openlocfilehash: da6fd8e0e6bfe2e2543f5c4a453ed769e412f1e9
ms.sourcegitcommit: 6cfc50d89528df977a8f6a55c1ad39d99800d9b4
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/03/2022
ms.locfileid: "8919359"
---
# <a name="create-intercompany-transactions"></a>创建内部公司交易

_**适用于：** 面向资源/非库存场景的 Project Operations_

内部公司交易是项目合同中属于一个公司或部门的时间和支出交易，而项目合同上的资源属于其他公司或部门。

批准内部公司交易后，将创建以下实际交易

| **交易记录类型** | **应用的价目表** | **交易货币** |
| --- | --- | --- |
| 成本 | 合同签订部门成本价目表 | 价格行上的货币 |
| 未记帐销售额。 系统仅对与具有记帐类型、时间和材料的合同子项关联的实际项创建这些内容。 | 合同项目销售价目表 | 合同货币 |
| 资源单位成本 | 资源单位成本价目表 | 价格行上的货币 |
| 部门间销售 | 合同签订部门成本价目表 | 价格行上的货币 |

成本、资源单位成本以及部门间销售交易定价和货币受 **部门** 影响。 决定如何在实施中构建公司和部门时，请务必记住这一点。

在创建商机、报价单、项目合同和项目记录时，系统会验证该合同签订部门的货币是否与合同签订公司的会计币种相匹配。 如果不相同，则无法创建这些记录。 通过转到 **Dataverse** > **设置** > **部门**，在 Dynamics 365 Project Operations 中定义部门货币。 转到 **总帐** > **分类帐设置** > **分类帐** 在 Dynamics 365 Finance 中定义公司的会计币种。 使用分类帐双重写入映射将货币同步到您的 Dataverse 环境。

在下列情况下，系统会创建资源单位成本和部门间销售实际值：

  - 当资源提供单位与合同单位不同时
  - 当资源供给公司与承包公司不同时

但是，只有资源公司与承包公司不同的交易会被转移到 Dynamics 365 Finance 环境进行其他会计处理。

项目实际值会计将记录在 Finance 内的 Project Operations 集成日记帐中。 系统将创建以下日记帐行。

| **交易记录类型** | **法律实体** | **过帐时创建项目交易** | **财务维度默认值来源** | **默认计费销售税组和计费物料销售税组** |
| --- | --- | --- | --- | --- |
| 成本 | 不会添加到集成日记帐 | 不适用 | 不适用 | 不适用 |
| 未记帐销售额 | 借款法律实体集成日记帐 | 是 | Project | **计费销售税组**：基于 **合同客户** <br/> **计费物料销售税组**：来自日记帐行上的当前法律实体项目类别 |
| 资源单位成本 | 贷款法律实体集成日记帐 | No | 内部公司客户 | **计费销售税组**：基于 **内部公司客户** <br/> **计费物料销售税组**：来自日记帐行上的当前法律实体项目类别 |
| 组织间销售 | 贷款法律实体集成日记帐 | No | 内部公司客户 | **计费销售税组**：基于 **内部公司客户** <br/> **计费物料销售税组**：来自日记帐行上的当前法律实体项目类别 |

### <a name="example-intercompany-transactions"></a>示例：内部公司交易

在 GBPM 工作的开发人员候芳音记录了 10 个小时的 USPM Adventure Works 项目工作，这得到了项目经理的认可。 GBPM 的开发人员成本是每小时 88 GBP。 开发人员每工作一小时，GBPM 将向 USPM 收取 120 美元。 对于由 GBPM 资源完成的工作，USPM 将向客户 Adventure Works 收取 200 美元。 有关详细信息，请参阅[配置内部公司开票](configure-intercompany-invoicing.md)。

1. 在 Project Operations 中，转到 **资源**，然后从列表中选择 **候芳音**。 在 **计划** 选项卡上的 **公司** 字段中，选择 **GBPM**。
2. 转到 **销售** > **客户**，然后选择 **新建** 以为 Adventure Works 创建新客户记录。
    1. 将公司设置为 **USPM**。
    2. 将 **关系类型** 设置为 **客户**。
    3. 选择 **客户组 10 – 国内**。
    4. 将货币设置为 **美元**。
    5. 保存记录。
3. 转到 **销售** > **项目合同**，并为 Adventure Works 创建新的项目合同。
    1. 将负责公司设置为 **USPM**，并将合同单位设置为 **Contoso Robotics US**。
    2. 选择 Adventure Works 作为客户。
    3. 选择某一产品价目表并保存记录。
    4. 在 **合同子项** 选项卡上，创建新合同子项。 设置任意名称，然后选择 **时间和材料** 作为记帐方法。
    5. 创建一个新项目，并将其与此合同子项相关联。
4. 以资源（**候芳音**）身份登录。 转到 **项目** > **时间条目**，并为 Adventure Works 项目创建时间条目。
5. 以项目经理身份登录。 转到 **项目** > **批准**，并批准候芳音记录的时间条目交易。
6. 导航到 Adventure Works 项目，然后选择 **相关** > **实际值**。 此时会创建以下实际值交易。

| **交易记录类型** | **单价** | **交易货币** | **金额** |
| --- | --- | --- | --- |
| 成本 | 120 | USD | 1200 |
| 未记帐销售额 | 200 | USD | 2000 |
| 资源单位成本 | 88 | GBP | 880 |
| 部门间销售 | 120 | USD | 1200 |

7. 以 USPM 会计身份登录。 打开 Project Operations 的“财务”实例，然后选择公司 **USPM**。 
8. 转到 **项目管理和会计** > **定期** > **Customer Engagement 上的 Project Operations** > **从暂存导入**，然后选择运行定期流程。 此定期流程将填写 Project Operations 集成日记帐。
9. 转到 **项目管理和会计** > **日记帐** > **Project Operations 集成日记帐** 并查看日记帐行。 系统将创建以下行。

    | **交易记录类型** | **单价** | **交易货币** | **金额** |
    | --- | --- | --- | --- |
    | 未记帐销售额 | 200 | USD | 2000 |

    如果系统设置为累积此项目的收入，则会过帐以下各项：

    - 借方：项目 - WIP 销售价值 200 美元
    - 贷方：项目 – 累积收入 200 美元

    此未记帐销售现在可以开票了。 可以在需要时在财务上过帐 Adventure Works 客户的账单。

10. 以 **GBPM** 会计身份登录。 打开 Project Operations 的“财务”实例，然后打开公司 **GBPM**。 
11. 转到 **项目管理和会计** > **定期** > **Project Operations 集成** > **从暂存表导入**，运行定期流程来填充 Project Operations 集成日记帐。
12. 转到 **项目管理和会计** > **日记帐** > **Project Operations 集成日记帐** 并查看这些行。 系统将创建以下行。

    | **交易记录类型** | **单价** | **交易货币** | **金额** |
    | --- | --- | --- | --- |
    | 资源单位成本 | 88 | GBP | 880 |
    | 部门间销售 | 120 | USD | 1200 |

    过帐这些记录将导致以下凭证交易：

    - 借方：项目成本 88 GBP
    - 贷方：工资分配 88 GBP

    如果系统设置为累积内部公司收入，则会过帐以下各项：

    - 借方：项目 - WIP 销售价值 120 美元
    - 贷方：项目 – 累积收入 120 美元

    系统现在已准备就绪，可以创建内部公司客户发票。


[!INCLUDE[footer-include](../includes/footer-banner.md)]
