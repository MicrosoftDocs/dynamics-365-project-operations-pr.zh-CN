---
title: 配置非库存材料以及待定供应商发票
description: 本主题说明如何启用非库存材料以及待定供应商发票。
author: sigitac
ms.date: 04/12/2021
ms.topic: article
ms.prod: ''
ms.reviewer: kfend
ms.author: sigitac
ms.openlocfilehash: 24418f3aad8356bd209eef7487a47a3870bce10f
ms.sourcegitcommit: 40f68387f594180af64a5e5c748b6efa188bd300
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/10/2021
ms.locfileid: "5993900"
---
# <a name="configure-non-stocked-materials-and-pending-vendor-invoices"></a><span data-ttu-id="98382-103">配置非库存材料以及待定供应商发票</span><span class="sxs-lookup"><span data-stu-id="98382-103">Configure non-stocked materials and pending vendor invoices</span></span>

<span data-ttu-id="98382-104">_**适用于：** 面向资源/非库存场景的 Project Operations_</span><span class="sxs-lookup"><span data-stu-id="98382-104">_**Applies To:** Project Operations for resource/non-stocked based scenarios_</span></span>

## <a name="minimum-version-requirement"></a><span data-ttu-id="98382-105">最低版本要求</span><span class="sxs-lookup"><span data-stu-id="98382-105">Minimum version requirement</span></span>

<span data-ttu-id="98382-106">对于 Dynamics 365 Project Operations 非库存/基于资源场景使用非库存材料和待定供应商发票需要以下版本：</span><span class="sxs-lookup"><span data-stu-id="98382-106">Using non-stocked materials and pending vendor invoices for Dynamics 365 Project Operations non-stocked/resource based scenarios requires the following versions:</span></span>

<span data-ttu-id="98382-107">Dynamics 365 Dataverse 解决方案：</span><span class="sxs-lookup"><span data-stu-id="98382-107">Dynamics 365 Dataverse solutions:</span></span>

- <span data-ttu-id="98382-108">Project Operations – 4.9.0.221 或更高版本</span><span class="sxs-lookup"><span data-stu-id="98382-108">Project Operations – 4.9.0.221 or higher</span></span>
- <span data-ttu-id="98382-109">双重写入应用程序业务流程解决方案 - 2.2.2.23 或更高版本</span><span class="sxs-lookup"><span data-stu-id="98382-109">Dual-write application orchestration solution - 2.2.2.23 or higher</span></span>

<span data-ttu-id="98382-110">Dynamics 365 Finance：</span><span class="sxs-lookup"><span data-stu-id="98382-110">Dynamics 365 Finance:</span></span>
- <span data-ttu-id="98382-111">10.0.18 (10.0.793.52) 或更高版本。</span><span class="sxs-lookup"><span data-stu-id="98382-111">10.0.18 (10.0.793.52) or higher.</span></span> <span data-ttu-id="98382-112">确保您的 Finance 环境是最新的，并且已应用所有质量更新以满足最低版本要求。</span><span class="sxs-lookup"><span data-stu-id="98382-112">Make sure that your Finance environment is current and all quality updates are applied to meet the minimum version requirements.</span></span>

## <a name="run-dual-write-maps-for-non-stocked-materials-and-vendor-invoice-integration"></a><span data-ttu-id="98382-113">运行非库存材料与供应商发票集成的双重写入映射</span><span class="sxs-lookup"><span data-stu-id="98382-113">Run Dual-write maps for non-stocked materials and vendor invoice integration</span></span>

<span data-ttu-id="98382-114">本节提供有关非库存材料以及供应商发票所需的具体映射的信息。</span><span class="sxs-lookup"><span data-stu-id="98382-114">This section provides information about specific the maps required for non-stocked materials and vendor invoices.</span></span> <span data-ttu-id="98382-115">验证[预配新环境](../environment/resource-provision-new-environment.md#run-project-operations-dual-write-maps)主题中列出的必备映射是否在您的环境中运行。</span><span class="sxs-lookup"><span data-stu-id="98382-115">Verify that the prerequisite maps listed in the [Provision a new environment](../environment/resource-provision-new-environment.md#run-project-operations-dual-write-maps) topic are running on your environment.</span></span>

1. <span data-ttu-id="98382-116">转到 Lifecycle Services (LCS)，导航到 LCS 项目，然后转到 **环境详细信息** 页。</span><span class="sxs-lookup"><span data-stu-id="98382-116">Go to Lifecycle Services (LCS), navigate to your LCS project, and go to the **Environment details** page.</span></span>
2. <span data-ttu-id="98382-117">在 **Common Data Service 环境信息** 部分，选择 **链接到面向应用程序的 CDS**。</span><span class="sxs-lookup"><span data-stu-id="98382-117">In the **Common Data Service Environment Information** section, select **Link to CDS for Apps**.</span></span> <span data-ttu-id="98382-118">选择链接后，您将被重定向到映射中的实体列表。</span><span class="sxs-lookup"><span data-stu-id="98382-118">After you select the link, you will be redirected to the list of entities in the mappings.</span></span>
3. <span data-ttu-id="98382-119">确保以下映射正在运行。</span><span class="sxs-lookup"><span data-stu-id="98382-119">Make sure the following maps are running.</span></span> <span data-ttu-id="98382-120">如果未运行，启动并确保包括所有相关的表映射。</span><span class="sxs-lookup"><span data-stu-id="98382-120">If they aren't running, start them and make sure to include all related table maps.</span></span>

    - <span data-ttu-id="98382-121">CDS 发布的独特产品（产品）</span><span class="sxs-lookup"><span data-stu-id="98382-121">CDS released distinct products (products)</span></span>
    - <span data-ttu-id="98382-122">供应商 v2 (msdyn_vendors)</span><span class="sxs-lookup"><span data-stu-id="98382-122">Vendors v2 (msdyn_vendors)</span></span>
    - <span data-ttu-id="98382-123">用于材料估算的 Project Operations 表 (msdyn_estimatelines)</span><span class="sxs-lookup"><span data-stu-id="98382-123">Project Operations table for material estimates (msdyn_estimatelines)</span></span>
    - <span data-ttu-id="98382-124">Project Operations 集成项目供应商发票导出实体 (msdyn_projectvendorinvoices)</span><span class="sxs-lookup"><span data-stu-id="98382-124">Project Operations integration project vendor invoice export entity (msdyn_projectvendorinvoices)</span></span>
    - <span data-ttu-id="98382-125">Project Operations 集成项目供应商发票明细导出实体 (msdyn_projectvendorinvoicelines)</span><span class="sxs-lookup"><span data-stu-id="98382-125">Project Operations integration project vendor invoice line export entity (msdyn_projectvendorinvoicelines)</span></span>
    - <span data-ttu-id="98382-126">Project Operations 集成实际值 (msdyn_actuals)。</span><span class="sxs-lookup"><span data-stu-id="98382-126">Project Operations integration actuals (msdyn_actuals).</span></span> <span data-ttu-id="98382-127">确保您运行的是映射版本 1.0.0.14 或更高版本。</span><span class="sxs-lookup"><span data-stu-id="98382-127">Make sure you are running map version 1.0.0.14 or higher.</span></span> <span data-ttu-id="98382-128">您可以在 **双重写入** 页的 **版本** 列中看到映射的活动版本。</span><span class="sxs-lookup"><span data-stu-id="98382-128">You can see the active version of the map in the **Version** column on the **Dual Write** page.</span></span> <span data-ttu-id="98382-129">您可以通过选择 **表映射版本** 然后保存所选版本来激活映射的新版本。</span><span class="sxs-lookup"><span data-stu-id="98382-129">You can activate a new version of the map by selecting **Table map version** and then saving the selected version.</span></span>

<span data-ttu-id="98382-130">如果您使用的是标准演示数据，可能还需要通过初始同步来停止并重新启动以下实体映射：</span><span class="sxs-lookup"><span data-stu-id="98382-130">If you are using standard demo data, you might also need to stop and restart the following entity maps with initial sync:</span></span>
  - <span data-ttu-id="98382-131">付款天数 CDS V2 (msdyn_paymentdays)</span><span class="sxs-lookup"><span data-stu-id="98382-131">Payment days CDS V2 (msdyn_paymentdays)</span></span>
  - <span data-ttu-id="98382-132">付款计划 (msdyn_paymentschedules)</span><span class="sxs-lookup"><span data-stu-id="98382-132">Payment schedule (msdyn_paymentschedules)</span></span>
  - <span data-ttu-id="98382-133">付款条款 (msdyn_paymentterms)</span><span class="sxs-lookup"><span data-stu-id="98382-133">Terms of payment (msdyn_paymentterms)</span></span>
  - <span data-ttu-id="98382-134">供应商组 (msdyn_vendorgroups)</span><span class="sxs-lookup"><span data-stu-id="98382-134">Vendor groups (msdyn_vendorgroups)</span></span>
  - <span data-ttu-id="98382-135">单位 (uom)</span><span class="sxs-lookup"><span data-stu-id="98382-135">Units (uom)</span></span>

> [!NOTE]
> <span data-ttu-id="98382-136">供应商组和单位的初始同步可能会因现有演示数据集中的一些记录而失败。</span><span class="sxs-lookup"><span data-stu-id="98382-136">The initial sync for vendor groups and units might fail for a few records in the existing demo data set.</span></span> <span data-ttu-id="98382-137">您可以忽略这些失败，因为它们不会阻止您在 Project Operations 中使用演示数据。</span><span class="sxs-lookup"><span data-stu-id="98382-137">You can ignore the failures as they won't prevent you from using demo data with Project Operations.</span></span>

## <a name="configure-prerequisites-in-dataverse"></a><span data-ttu-id="98382-138">在 Dataverse 中配置先决条件</span><span class="sxs-lookup"><span data-stu-id="98382-138">Configure prerequisites in Dataverse</span></span>

### <a name="activate-workflow-to-create-accounts-based-on-vendor-entity"></a><span data-ttu-id="98382-139">激活工作流以基于供应商实体创建客户</span><span class="sxs-lookup"><span data-stu-id="98382-139">Activate workflow to create accounts based on vendor entity</span></span>

<span data-ttu-id="98382-140">双重写入业务流程解决方案提供[供应商主集成](/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/vendor-mapping.md)。</span><span class="sxs-lookup"><span data-stu-id="98382-140">The Dual Write Orchestration solution provides [Vendors master integration](/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/vendor-mapping.md).</span></span> <span data-ttu-id="98382-141">作为此功能的先决条件，必须在 **客户** 实体中创建供应商数据。</span><span class="sxs-lookup"><span data-stu-id="98382-141">As a prerequisite for this feature, vendor data must be created in the **Accounts** entity.</span></span> <span data-ttu-id="98382-142">激活模板工作流流程，在 **客户** 表中创建供应商，如[在供应商设计之间切换](/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/vendor-switch.md#use-the-extended-vendor-design-for-vendors-of-the-organization-type)中所述。</span><span class="sxs-lookup"><span data-stu-id="98382-142">Activate a template workflow process to create vendors in the **Accounts** table as described in [Switch between vendor designs](/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/vendor-switch.md#use-the-extended-vendor-design-for-vendors-of-the-organization-type).</span></span>

### <a name="set-products-to-be-created-as-active"></a><span data-ttu-id="98382-143">将产品设置为以活动状态创建</span><span class="sxs-lookup"><span data-stu-id="98382-143">Set products to be created as active</span></span>

<span data-ttu-id="98382-144">非库存材料必须在 Finance 中配置为 **已发布产品**。</span><span class="sxs-lookup"><span data-stu-id="98382-144">Non-stocked materials must be configured as **Released products** in Finance.</span></span> <span data-ttu-id="98382-145">双重写入业务流程解决方案提供现成的[已发布产品与 Dataverse 产品集成目录](/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/product-mapping.md)。</span><span class="sxs-lookup"><span data-stu-id="98382-145">The Dual Write Orchestration solution provides an out-of-the-box [Released products integration to Dataverse Product catalog](/dynamics365/fin-ops-core/dev-itpro/data-entities/dual-write/product-mapping.md).</span></span> <span data-ttu-id="98382-146">默认情况下，Finance 中的产品在草稿状态下同步到 Dataverse。</span><span class="sxs-lookup"><span data-stu-id="98382-146">By default, products from Finance are synchronized to Dataverse in a draft state.</span></span> <span data-ttu-id="98382-147">要将产品同步到活动状态，以可以将其直接用于材料使用文档或待定供应商发票，转到 **系统** > **管理** > **系统管理** > **系统设置**，在 **销售** 选项卡上，将 **创建处于活动状态的产品** 设置为 **是**。</span><span class="sxs-lookup"><span data-stu-id="98382-147">To synchronize the product to an active state so that it can be directly used in material usage documents or pending vendor invoices, go to **System** > **Administration** > **System administration** > **System settings**, and on the **Sales** tab, set **Create products in active state** to **Yes**.</span></span>

## <a name="configure-prerequisites-in-finance"></a><span data-ttu-id="98382-148">在 Finance 中配置先决条件</span><span class="sxs-lookup"><span data-stu-id="98382-148">Configure prerequisites in Finance</span></span>

### <a name="enable-the-feature-key-for-pending-vendor-invoices"></a><span data-ttu-id="98382-149">为待定供应商发票启用功能键</span><span class="sxs-lookup"><span data-stu-id="98382-149">Enable the feature key for pending vendor invoices</span></span>

<span data-ttu-id="98382-150">完成以下步骤，启用在待定供应商发票明细中添加项目详细信息的功能。</span><span class="sxs-lookup"><span data-stu-id="98382-150">Complete the following steps to enable functionality to add project details on pending vendor invoice lines.</span></span>

1. <span data-ttu-id="98382-151">在 Finance 中，转到 **功能管理** 工作区。</span><span class="sxs-lookup"><span data-stu-id="98382-151">In Finance, go to the **Feature Management** workspace.</span></span>
2. <span data-ttu-id="98382-152">在功能列表中，找到 **为基于资源/非库存场景启用 Project Operations 上的待定供应商发票** 功能，选择 **启用**。</span><span class="sxs-lookup"><span data-stu-id="98382-152">In the feature list, find **Enable pending vendor invoices on Project Operations for resource based/non-stocked scenarios** feature and select **Enable**.</span></span>

### <a name="define-category-groups-and-project-categories-for-items"></a><span data-ttu-id="98382-153">为物料定义类别组和项目类别</span><span class="sxs-lookup"><span data-stu-id="98382-153">Define category groups and project categories for items</span></span>

<span data-ttu-id="98382-154">为 **物料** 交易类型配置至少一个类别组，并使用此组至少配置一个项目类别。</span><span class="sxs-lookup"><span data-stu-id="98382-154">Configure at least one category group for the **Item** transaction type , and at least one project category using this group.</span></span> <span data-ttu-id="98382-155">有关详细信息，请参阅[配置项目类别](../project-accounting/configure-project-categories.md#category-groups)。</span><span class="sxs-lookup"><span data-stu-id="98382-155">For more information, see [Configure project categories](../project-accounting/configure-project-categories.md#category-groups).</span></span>

<span data-ttu-id="98382-156">查看项目成本和收入配置文件，并为物料交易配置分类帐过帐设置。</span><span class="sxs-lookup"><span data-stu-id="98382-156">Review the project cost and revenue profiles, and configure ledger posting setup for item transactions.</span></span> <span data-ttu-id="98382-157">有关详细信息，请参阅[配置收费项目会计](../project-accounting/configure-accounting-billable-projects.md)。</span><span class="sxs-lookup"><span data-stu-id="98382-157">For more information, see [Configure accounting for billable projects](../project-accounting/configure-accounting-billable-projects.md).</span></span>

### <a name="set-up-a-write-in-product"></a><span data-ttu-id="98382-158">设置目录外产品</span><span class="sxs-lookup"><span data-stu-id="98382-158">Set up a write-in product</span></span>

<span data-ttu-id="98382-159">在 Project Operations 中，您可以记录已发布产品目录中配置的目录产品和目录外产品的材料估算和使用情况。</span><span class="sxs-lookup"><span data-stu-id="98382-159">In Project Operations, you can record material estimates and usage for catalog products that are configured in the released product catalog and for write-in products.</span></span> <span data-ttu-id="98382-160">使用目录外产品需要为此目的在 Finance 中配置的一个已发布产品。</span><span class="sxs-lookup"><span data-stu-id="98382-160">Using write-in products requires a single released product that's configured in Finance for this purpose.</span></span> <span data-ttu-id="98382-161">请完成以下步骤配置目录外产品。</span><span class="sxs-lookup"><span data-stu-id="98382-161">Complete the following steps to configure a write-in product.</span></span> <span data-ttu-id="98382-162">在将 Project Operations 用于资源/非库存场景的每个法人中重复这些步骤。</span><span class="sxs-lookup"><span data-stu-id="98382-162">Repeat these steps in each legal entity that is using Project Operations for resource/non-stocked scenarios.</span></span>

1. <span data-ttu-id="98382-163">在 Finance 中，转到 **产品信息管理** > **产品** > **已发布产品**，选择 **新建**。</span><span class="sxs-lookup"><span data-stu-id="98382-163">In Finance, go to **Product Information Management** > **Products** > **Released products**, and select **New**.</span></span>
2. <span data-ttu-id="98382-164">在 **产品类型** 字段中，选择 **物料**，在 **产品子类型** 字段中，选择 **产品**。</span><span class="sxs-lookup"><span data-stu-id="98382-164">In the **Product type** field, select **Item** and in the **Product subtype** field, select **Product**.</span></span>
3. <span data-ttu-id="98382-165">输入产品编号 (WRITEIN) 和产品名称（目录外产品）。</span><span class="sxs-lookup"><span data-stu-id="98382-165">Enter the product number (WRITEIN) and the product name (Write-in Product).</span></span>
4. <span data-ttu-id="98382-166">选择物料模型组。</span><span class="sxs-lookup"><span data-stu-id="98382-166">Select  the item model group.</span></span> <span data-ttu-id="98382-167">确保您选择的物料模型组将 **库存策略库存产品** 字段设置为 **False**。</span><span class="sxs-lookup"><span data-stu-id="98382-167">Make sure that the item model group you select has the **Inventory policy Stocked product** field set to **False**.</span></span>
5. <span data-ttu-id="98382-168">在 **物料组**、**存储维度组** 和 **跟踪维度组** 字段中选择值。</span><span class="sxs-lookup"><span data-stu-id="98382-168">Select values in the **Item group**, **Storage dimension group**, and **Tracking dimension group** fields.</span></span> <span data-ttu-id="98382-169">仅将 **存储维度** 用于 **站点**，不设置任何跟踪维度。</span><span class="sxs-lookup"><span data-stu-id="98382-169">Use the **Storage dimension** for **Site** only, and do not set any tracking dimensions.</span></span>
6. <span data-ttu-id="98382-170">在 **库存单位**、**采购单位** 和 **销售单位** 字段中选择值，然后保存更改。</span><span class="sxs-lookup"><span data-stu-id="98382-170">Select values in the **Inventory unit**, **Purchase unit**, and **Sales unit** field, and then save your changes.</span></span>
7. <span data-ttu-id="98382-171">在 **计划** 选项卡中，设置默认订单设置，在 **库存** 选项卡上，设置默认的站点和仓库。</span><span class="sxs-lookup"><span data-stu-id="98382-171">In the **Plan** tab, set the default order settings, and on the **Inventory** tab, set the default site and warehouse.</span></span>
8. <span data-ttu-id="98382-172">转到 **项目管理和会计** > **设置** > **项目管理和会计参数**，打开 **Dynamics 365 Dataverse 上的 Project Operations**。</span><span class="sxs-lookup"><span data-stu-id="98382-172">Go to **Project management and accounting** > **Setup** > **Project management and accounting parameters** and open **Project Operations on Dynamics 365 Dataverse**.</span></span> 
9. <span data-ttu-id="98382-173">在 **材料** 选项卡上的 **目录外产品** 字段中，选择您创建的产品。</span><span class="sxs-lookup"><span data-stu-id="98382-173">On the **Materials** tab, in the **Write-in product** field, select the product you created.</span></span>
10. <span data-ttu-id="98382-174">在您的 Dataverse 环境中，在站点地图中，打开 **产品** 实体，查找目录外产品记录。</span><span class="sxs-lookup"><span data-stu-id="98382-174">In your Dataverse environment, in the site map, open the **Products** entity and find the write-in product record.</span></span> 
11. <span data-ttu-id="98382-175">打开记录详细信息，将产品状态设置为 **已停用**。</span><span class="sxs-lookup"><span data-stu-id="98382-175">Open the record details and set product state to **Retired**.</span></span> <span data-ttu-id="98382-176">此产品状态可防止任何人意外地在材料估算和使用文档中直接使用此记录。</span><span class="sxs-lookup"><span data-stu-id="98382-176">This product state prevents anyone from accidentally using this record directly in material estimates and usage documents.</span></span>

### <a name="set-up-a-procurement-integration-account"></a><span data-ttu-id="98382-177">设置采购集成帐户</span><span class="sxs-lookup"><span data-stu-id="98382-177">Set up a procurement integration account</span></span>

<span data-ttu-id="98382-178">过帐具有属于项目的明细的待定供应商发票时，采购集成帐户将用作清算帐户。</span><span class="sxs-lookup"><span data-stu-id="98382-178">The procurement integration account is used as a clearing account when posting a pending vendor invoice with lines attributed to a project.</span></span>

<span data-ttu-id="98382-179">当系统过帐待定供应商发票时，此帐户将用于项目成本金额。</span><span class="sxs-lookup"><span data-stu-id="98382-179">When the system posts a pending vendor invoice, this account is used for the project cost amount.</span></span> <span data-ttu-id="98382-180">供应商发票详细信息在 Dataverse 中处理，并将创建相应的项目实际值。</span><span class="sxs-lookup"><span data-stu-id="98382-180">The vendor invoice details are processed in Dataverse, and a corresponding project actual is created.</span></span> <span data-ttu-id="98382-181">项目实际值的信息将被添加到 Project Operations 集成日记帐中。</span><span class="sxs-lookup"><span data-stu-id="98382-181">The information from the project actual is added to the Project Operations Integration journal.</span></span> <span data-ttu-id="98382-182">过帐集成日记帐时，将从采购集成帐户中清除金额并将其记录到项目成本中。</span><span class="sxs-lookup"><span data-stu-id="98382-182">When you post the integration journal, the amount is cleared from the procurement integration account and recorded to the project cost.</span></span>

1. <span data-ttu-id="98382-183">要设置采购集成帐户，转到 **项目管理和会计** > **设置** > **项目管理和会计参数**，打开 **Dynamics 365 Dataverse 上的 Project Operations**。</span><span class="sxs-lookup"><span data-stu-id="98382-183">To set up the procurement integration account, go to **Project management and accounting** > **Setup** > **Project management and accounting parameters**, and open **Project Operations on Dynamics 365 Dataverse**.</span></span> 
2. <span data-ttu-id="98382-184">选择 **材料** 选项卡，然后在 **采购集成帐户** 字段中选择一个值。</span><span class="sxs-lookup"><span data-stu-id="98382-184">Select the **Materials** tab, and select a value in the **Procurement integration account** field.</span></span>

#### <a name="set-up-project-category-defaults-for-an-item"></a><span data-ttu-id="98382-185">为物料设置项目类别默认值</span><span class="sxs-lookup"><span data-stu-id="98382-185">Set up project category defaults for an item</span></span>

1. <span data-ttu-id="98382-186">在 Finance 中，转到 **项目管理和会计** > **设置** > **项目管理和会计参数**，打开 **Dynamics 365 Dataverse 上的 Project Operations**。</span><span class="sxs-lookup"><span data-stu-id="98382-186">In Finance, go to **Project management and accounting** > **Setup** > **Project management and accounting parameters**, and open **Project Operations on Dynamics 365 Dataverse**.</span></span> 
2. <span data-ttu-id="98382-187">在 **项目类别默认值** 选项卡上的 **物料** 字段中，选择一个值。</span><span class="sxs-lookup"><span data-stu-id="98382-187">On the **Project category defaults** tab, in the **Item** field, select a value.</span></span> <span data-ttu-id="98382-188">如果未在项目实际值记录中设置项目类别，此项目类别将用于材料交易。</span><span class="sxs-lookup"><span data-stu-id="98382-188">This project category is used for material transactions if the project category wasn't set on the project actuals record.</span></span>
