---
title: 管理项目发票方案
description: 本文提供有关使用基于资源/非库存场景的 Project Operations 处理面向客户的发票的详细信息。
author: sigitac
ms.date: 04/12/2021
ms.topic: article
ms.reviewer: johnmichalak
ms.author: sigitac
ms.openlocfilehash: ef6003499f1372a51d7d1606db6f5bf9722a369d
ms.sourcegitcommit: 6cfc50d89528df977a8f6a55c1ad39d99800d9b4
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/03/2022
ms.locfileid: "8927823"
---
# <a name="manage-project-invoice-proposals"></a>管理项目发票方案

_**适用于：** 面向资源/非库存场景的 Project Operations_

满足以下两个条件时，您的账单部门可以处理项目发票方案：

  - 项目经理在 Microsoft Dataverse 中确认估价发票。
  - 估价发票中包含的所有时间和材料未记帐的销售交易都使用 Dynamics 365 **Project Operations 集成** 日记帐过帐。

使用以下步骤在 Dynamics 365 Finance 中完成项目发票方案。

1. 查看时间和材料交易的账单信息，并发布 **Project Operations 集成** 日记帐。
2. 查看固定价格记帐里程碑的记帐信息。
3. 查看并设置项目发票方案的格式。
4. 发布和打印项目发票。

## <a name="manage-billing-information-in-the-project-operations-integration-journal"></a>在 Project Operations 集成日记帐中管理记帐信息

在 Dataverse 中创建的项目实际值将由项目会计在 Finance 中审核和过帐。 有关使用集成日记帐的详细信息，请参阅 [Project Operations 中的集成日记帐](../project-accounting/project-operations-integration-journal.md)。

成本实际值和未记帐实际销售额作为单独的行添加到集成日记帐中：

  - 成本实际值中的单位成本费和成本金额默认来自 Dataverse 中的项目实际成本交易。
  - 未记帐销售交易中的销售单价和销售金额默认来自 Dataverse 中项目的实际未记帐销售交易。

### <a name="billing-sales-tax"></a>记帐销售税

账单的销售税计算由 **Project Operations 集成** 日记帐行上未记帐销售记录中的 **记帐销售税组** 和 **记帐物料销售税组** 字段组合确定。 系统根据 **项目管理和会计参数** 页上 **财务** 选项卡上的设置来设置这些字段值的默认值。

- **销售税组方法** 确定记帐销售税组的设置默认值逻辑：
  
  - **项目**：将始终根据项目设置默认记帐销售税组。 您可以在 **所有项目** 页上选择 **显示默认会计** 来查看或更改项目中的默认记帐销售税组。
  - **项目合同**：将始终根据项目合同设置默认记帐销售税组。 您可以在 **项目合同** 页上选择 **显示默认会计** 来查看或更改项目合同中的默认记帐销售税组。
  - **客户**：将始终根据客户设置默认记帐销售税组。
  - **搜索**：将搜索上述所有实体，然后选择第一个可用值。 搜索从 **项目** 实体开始，然后是 **项目合同** 实体，最后是 **客户** 实体。

- **物料销售税组方法** 确定记帐物料销售税组的设置默认值逻辑：
  
  - 对于时间、支出和费用交易类型，记帐物料销售税组将始终默认来自 **项目类别** 实体。
  - 对于材料交易类型，记帐物料销售税组根据 **项目管理和会计参数** 中的 **物料销售税组方法** 设置设置默认值。 物料编号默认来自 **已发布产品** 实体的物料销售税组。 类别默认来自 **项目类别** 实体的物料销售税组。

### <a name="financial-dimensions"></a>财务维度

**Project Operations 集成** 日记帐中的未记帐销售记录的财务维度默认来自 **项目** 实体。 可以通过选择 **分配金额** 来查看和调整财务维度。 如果您需要在过帐集成日记帐之后但在确认估价发票之前更改未记帐销售记录的财务维度，请转到 **所有项目** > **管理** > **已过帐交易**，选择交易，然后选择 **处理** > **调整会计**。

### <a name="exchange-rates"></a>汇率

Dataverse 中的未记帐交易货币在 Finance 中用作交易货币，将使用 Finance 中定义的汇率转换为公司的会计币种。


## <a name="manage-the-financial-attributes-of-billing-milestones"></a>管理记帐里程碑的财务属性 

使用固定价格记帐方法的项目合同子项通过[固定价格里程碑](../sales/invoice-schedules-contract-line.md#create-a-fixed-price-invoice-schedule-for-a-contract-line)开票。 项目会计可以转到 **项目管理和会计** > **所有项目** > **管理** > **记帐交易** 来查看 Finance 中的记帐里程碑。

### <a name="billing-sales-tax"></a>记帐销售税

当在 Dataverse 中创建新的记帐里程碑时，**销售税组** 和 **物料销售税组** 值默认来自设置。 系统根据 **项目管理和会计参数** 页上 **财务** 选项卡上的设置来将这些字段设置为默认值。

- **销售税组方法** 确定 **记帐销售税组** 的设置默认值逻辑：

    - **项目** 将始终根据项目设置默认记帐销售税组。 您可以在 **所有项目** 页上选择 **显示默认会计** 来查看或更改项目中的默认销售税组。
    - **项目合同** 将始终根据项目合同设置默认记帐销售税组。 您可以在 **项目合同** 页上选择 **显示默认会计** 来查看或更改项目合同中的默认记帐销售税组。
    - **客户** 将始终根据客户设置默认记帐销售税组。
    - **搜索** 将搜索此列表中的所有实体，然后选择第一个可用值。 搜索从 **项目** 实体开始，然后是 **项目合同** 实体，再然后是 **客户** 实体。

- **固定价格里程碑物料销售税组** 用作记帐里程碑的 **物料销售税组** 字段中的默认值。 会计可以在 **帐户内交易** 页查看和修改此值。 创建项目发票方案明细时，系统将使用帐户内交易中的值。
 

### <a name="financial-dimensions"></a>财务维度

固定价格记帐里程碑的默认财务维度在项目合同子项上设置。 转到 **项目合同** > **显示默认会计**，在 **合同子项** 选项卡上，选择 **价格合同子项**，然后设置您要用作默认值的财务维度值 。

项目会计可以编辑发票里程碑上的销售税和财务维度信息，直到项目发票方案创建。


## <a name="create-project-invoice-proposals"></a>创建项目发票方案

可以在 **项目管理和会计** 模块中转到 **项目发票** > **项目发票方案** 来查看项目发票方案。

项目发票方案标头将在 Dataverse 中确认估价发票后在 Finance 中创建。 为便于对帐，系统将 Finance 中的项目发票方案编号设置为与 Dataverse 中的估价发票 ID 相同的编号。 由于估价发票不一定按创建顺序确认，因此 Finance 中的项目发票方案编号规则必须允许更改为更小和高大数字。 按照以下步骤配置编号规则：

1. 在Finance 中，转到 **组织管理** > **编号规则** > **编号规则**。
2. 在 **区域** 筛选器中，选择 **项目**。
3. 在 **引用** 筛选器中，选择 **发票方案**。
4. 使用 **公司** 字段筛选启用了 Project Operations Dataverse 集成的每个法人。
5. 打开 **编号规则详细信息**，在 **常规** 选项卡上：

    - **允许用户更改为: 更小数字** = **是**
    - **允许用户更改为: 更大数字** = **是**

项目发票方案行将由系统使用定期流程 **从暂存表导入**（**项目管理和会计** > **定期** > **Project Operations 集成** > **从暂存表导入**）添加。 此流程可以手动运行，也可以使用定期计划运行。 在所有行都准备好开票之前，系统不会在发票方案文档中添加行。 时间和材料交易仅在使用 **Project Operations 集成** 日记帐过帐后才可以开票。

## <a name="format-and-print-invoice-proposals"></a>设置发票方案的格式和打印

项目会计可以使用 **设置发票方案的格式** 页和打印管理功能自定义项目发票的打印输出。

### <a name="format-invoice-proposals"></a>设置发票方案的格式

**设置发票方案的格式** 页允许自定义分组交易显示在客户项目发票中。

1. 在 **项目发票方案** 页上，选择 **打印** > **设置发票方案的格式**。
2. 选择 **新建** 为项目发票打印输出创建新的分组。
3. 在 **详细信息/摘要** 字段中，选择用于此分组的选项：

    - 选择 **详细信息** 可以打印客户发票的交易详细信息。
    - 选择 **摘要** 可以打印客户发票的交易摘要。

> [!NOTE]
> 在 **设置发票方案的格式** 页的 **详细信息/摘要** 字段中的选择，将覆盖在 **发票方案** 页的 **发票格式** 字段中选择的打印详细发票或摘要发票的选项。

- 在 **可用交易** 选项卡上选择要包括在此部分的交易明细，然后选择 **包括交易** 将其移到 **选定交易** 选项卡上。
- 选择 **上移** 和 **下移** 更改各个部分的顺序。
- 选择 **打印预览** 预览设置了格式的发票。

### <a name="print-management"></a>打印管理

打印管理使用不同的报表文件来打印、指定目标和自定义发票的页脚文本。 打印管理可以在模块级别设置，但是对于特定客户、合同或发票方案，可以替代这些设置。 要在 **项目发票方案** 页上访问此功能，请选择 **打印** > **打印管理**。

打印管理设置显示为树视图，其中的每个节点级别显示要调整的可用文档。 您可以在模块、客户、合同或发票方案文档级别分配自定义打印输出。 要修改原始文档的打印输出，请展开所需节点，然后选择 **原始项**。 在 **报表格式** 字段中，选择要用于打印的报表格式。 您可以通过使用[业务文档管理框架](/dynamics365/fin-ops-core/dev-itpro/analytics/er-business-document-management)来使用自定义报表格式。

## <a name="post-invoice-proposals"></a>发布发票方案

在查看和编辑发票并且发票方案行令人满意后，请检查发票总额和销售税。 在 **详细信息** 组中，选择 **总额**，然后选择 **发布** 发布发票。

要在发布前查看发票，请清除 **发布** 复选框。 **估价** 将被打印在发票上，以表示它是示例发票。 要打印发票，请选中 **打印发票** 复选框。

除了 **发票方案** 页之外，还可以通过运行定期作业 **发布发票方案** 来发布发票方案。 要查找此作业，请转到 **项目管理和会计** > **定期** > **项目发票** > **发布发票方案**。

此页面显示所有准备好发布的发票方案。 您可以通过选择 **批处理** 来计划发票方案的发布。 将 **批处理参数** 设置为 **是**，然后通过选择 **定期** 设置批处理的定期模式。


[!INCLUDE[footer-include](../includes/footer-banner.md)]
